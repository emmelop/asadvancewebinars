{
	"name": "01_CREATE_ETL_VIEWS_OD",
	"properties": {
		"folder": {
			"name": "W01-ASyn4-BIBA_Roles/Demo 02"
		},
		"content": {
			"query": "--SALES\n--DROP SCHEMA etl\n--GO\n--DROP VIEW etl.sales\n--GO\nCREATE SCHEMA etl\n\n-- start modeling\n\nGO\n/*\nThis view is heavy due is crossing 2M rows in sales headers with 868M in fact-sales.\n*/\nCREATE VIEW etl.sales as\n    SELECT SaleLineId\n    ,salesline.[SaleId]\n    ,[InvoiceLine]\n    ,[OldTicket]\n    ,[InvoiceCode]\n    ,[Quantity]\n    ,[SalePrice]\n    ,[PurchasePrice]\n    ,[UnitMeasure]\n    ,[Date]\n    ,[StoreCode]\n    ,[CustomerId]\n    ,[ProductCode]\n    FROM\n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/SalesLines/*/*.parquet',\n        FORMAT='PARQUET'\n    )\n    WITH (\n        [SaleLineId] bigint,\n        [SaleId] int,\n        [InvoiceLine] int,\n        [ProductCode] nvarchar(10),\n        [Quantity] numeric(18,4),\n        [SalePrice] numeric(18,4),\n        [PurchasePrice] numeric(18,4),\n        [UnitMeasure] nvarchar(1)\n    ) AS [salesline] \n    INNER JOIN \n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/SalesHeader/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [SaleId] int,\n        [OldTicket] nvarchar(20),\n        [InvoiceCode] nvarchar(20),\n        [Date] date,\n        [StoreCode] nvarchar(10),\n        [CustomerId] int\n    ) AS [salesheader]\n    ON salesheader.SaleId = salesline.SaleId\nGO\n-- PRODUCT\nCREATE VIEW etl.product as\n\tSELECT [ProductCode]\n\t,[ProductName]\n\t,[Price]\n\t,[LastPurchasePrice]\n\t,prod.[CategoryCode]\n\t,cat.Category\n\t,line.Line\n\t,[PurchaseUnit]\n\t,[SaleUnit]\n\t,[RegularSupplier]\n\t,[Weight]\n\t,[Locked]\n\t,[PostingGroup]\n\t,[VAT_Bus_PostingGr_Price]\n\t,[VAT_Prod_PostingGroup]\n\tFROM OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/product/*/*.parquet',\n        FORMAT='PARQUET'\n    )\n    WITH (\n        [ProductCode] varchar(10),\n\t\t[ProductName] varchar(40),\n\t\t[Price] numeric(18,4),\n\t\t[LastPurchasePrice] numeric(18,4),\n\t\t[CategoryCode] varchar(2),\n\t\t[PurchaseUnit] varchar(1),\n\t\t[SaleUnit] varchar(1),\n\t\t[RegularSupplier] varchar(6),\n\t\t[Weight] numeric(18,4),\n\t\t[Locked] int,\n\t\t[LastModifiedDate] datetime2(7),\n\t\t[PostingGroup] varchar(10),\n\t\t[VAT_Bus_PostingGr_Price] varchar(10),\n\t\t[VAT_Prod_PostingGroup] varchar(10)\n    ) [prod]\n\tleft join \n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Categories/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [CategoryCode] varchar(2),\n\t\t[Category] varchar(40),\n        [Line] varchar(20)\n    ) [cat] on cat.CategoryCode = prod.[CategoryCode]\n\tleft join\n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Line/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [Codigo] int,\n\t\t[Line] varchar(20)\n    ) [line] on cat.line = line.codigo\nGO\n-- CUSTOMER\nCREATE VIEW etl.customer as\n    SELECT  [CustomerID]\n\t,[CustomerCode]\n\t,[Name]\n\t,[Lastname]\n\t,[Birthday]\n\t,[MaritalStatus]\n\t,[Gender]\n\t,[Email]\n\t,[AnnualIncome]\n\t,[TotalChildren]\n\t,[ChildrenAtHome]\n\t,[PostalCode]\n\t,country.CountryName as [Country]\n\t,occ.Occupation\n\t,acc.[AcademicLevel]\n\tFROM  \n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Customer/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [CustomerID] int,\n\t\t[CustomerCode] varchar(20),\n\t\t[Name] varchar(40),\n\t\t[Lastname] varchar(40),\n\t\t[Birthday] date,\n\t\t[MaritalStatus] varchar(1),\n\t\t[Gender] varchar(1),\n\t\t[Email] varchar(40),\n\t\t[AnnualIncome] numeric(18,4),\n\t\t[TotalChildren] int,\n\t\t[ChildrenAtHome] int,\n\t\t[OccupationId] bigint,\n\t\t[AcademicLevelId] bigint,\n\t\t[PostalCode] varchar(20),\n\t\t[Country] varchar(4)\n    ) [cust]\n\tleft join\n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Countries/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [CountryCode] varchar(4),\n\t\t[CountryName] varchar(100)\n    ) country on country.CountryCode = cust.Country\n\tleft join \n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Occupation/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [OccupationId] bigint,\n\t\t[Occupation] varchar(30)\n    ) occ on occ.OccupationId = cust.[OccupationId]\n\tleft join \n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/AcademicLevel/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n\t\t[AcademicLevelId] bigint,\n\t\t[AcademicLevel] varchar(40)\n    ) acc on acc.AcademicLevelId = cust.[AcademicLevelId]\nGO\n-- STORE\ncreate view etl.store as\n\tSELECT [StoreCode],\n\t[StoreName],\n\tcountry.[Latitude],\n\tcountry.[Longitude],\n\t[sq_ft_surface],\n\t[SizeGroup],\n\t[Employees],\n\t[RentBase],\n\t[RentPriceApplyReferenceIndex],\n\t[RentYearContract],\n\t[PostalCode],\n\tcountry.CountryName as [Country],\n\t[IsDistributedData], \n\t[IsActive],\n\t[StoreId]\n\tFROM   \n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Stores/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n     \t[StoreCode] varchar(10),\n\t\t[StoreName] varchar(40),\n\t\t[Latitude] numeric(10,6),\n\t\t[Longitude] numeric(10,6),\n\t\t[sq_ft_surface] int,\n\t\t[SizeGroup] varchar(10),\n\t\t[Employees] int,\n\t\t[RentBase] numeric(18,4),\n\t\t[RentPriceApplyReferenceIndex] bit,\n\t\t[RentYearContract] int,\n\t\t[PostalCode] varchar(20),\n\t\t[Country] varchar(4),\n\t\t[IsDistributedData] bit,\n\t\t[IsActive] bit,\n\t\t[StoreId] int   \n    ) [store]\n\tleft join\n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/raw/Countries/*/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [CountryCode] varchar(4),\n\t\t[CountryName] varchar(100),\n        [latitude] numeric(28,5),\n\t\t[longitude] numeric(28,5)\n    ) [country] on country.CountryCode = store.Country\nGO\n-- DATE\ncreate view etl.date as\nSELECT\n    [DateKey],\n    [Date],\n    [DateTime],\n    [YearMonth],\n    [YearMonthDescription],\n    [NYear],\n    [NMonth],\n    [NWeek],\n    [NWeekDay],\n    [NMonthDay],\n    [NYearDay],\n    [NQuarter],\n    [NSemester],\n    [DayName],\n    [SortDayName],\n    [MonthName],\n    [SortMonthName]\nFROM\n    OPENROWSET(\n        BULK 'https://dlsasa.dfs.core.windows.net/raw/curated/date/*.parquet',\n        FORMAT='PARQUET'\n    ) \n    WITH (\n        [DateKey] int,\n        [Date] date,\n        [DateTime] datetime2(7),\n        [YearMonth] int,\n        [YearMonthDescription] varchar(8),\n        [NYear] int,\n        [NMonth] int,\n        [NWeek] int,\n        [NWeekDay] int,\n        [NMonthDay] int,\n        [NYearDay] int,\n        [NQuarter] int,\n        [NSemester] int,\n        [DayName] varchar(15),\n        [SortDayName] varchar(5),\n        [MonthName] varchar(15),\n        [SortMonthName] varchar(5)\n    ) [date]\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "Built-in",
				"databaseName": "sod_stagg01"
			}
		},
		"type": "SqlQuery"
	}
}